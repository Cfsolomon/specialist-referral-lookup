<!DOCTYPE html>
<html>
<head>
  <title>Doctor/Patient Lookup</title>
  <style>
    body { font-family: Arial; margin:0; padding:0; }
    header { background:#004080; color:white; padding:20px; text-align:center; font-size:24px; }
    footer { background:#f0f0f0; color:#333; padding:10px; text-align:center; font-size:12px; position:fixed; bottom:0; width:100%; }
    main { padding:20px; margin-bottom:60px; }
    input, button { width: 100%; margin: 6px 0; padding: 10px; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; word-wrap: break-word; }
    @media (max-width: 600px) { table, thead, tbody, th, td, tr { display: block; } th { background: #f0f0f0; } td { border: none; padding: 6px; } }
    #message { color:red; font-weight:bold; margin:10px 0; }
    #message.success { color:#05620f; }
  </style>
</head>
<body>
  <header>AES Referring Doctors/Patients</header>
  <main>
    <h2>Search Doctors by Patient</h2>
    <input id="patientInput" type="text" placeholder="Enter patient name" />
    <button id="searchPatientBtn" onclick="searchPatient()">Search</button>

    <h2>Search Patients by Doctor</h2>
    <input id="docLast" type="text" placeholder="Doctor Last Name" />
    <input id="docFirst" type="text" placeholder="Doctor First Name" />
    <button id="searchDoctorBtn" onclick="searchDoctor()">Search</button>

    <div id="message"></div>

    <table id="results">
      <thead>
        <tr>
          <th>Doctor</th>
          <th>Specialty</th>
          <th>Address</th>
          <th>Phone</th>
          <th>Fax</th>
          <th>Email</th>
          <th>Patients</th>
          <th>From</th>
          <th>NPI</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
  <footer>
    &copy; <span id="year"></span> Developed by Cindy Solomon<br>
    Last updated: <?= lastUpdated ?>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function setMessage(text, ok=false) {
      const div = document.getElementById('message');
      div.textContent = text || '';
      div.className = ok ? 'success' : '';
    }

    function renderResults(data) {
      const tbody = document.querySelector('#results tbody');
      if (!data || data.length === 0) {
        setMessage("No results, try different name(s).");
        tbody.innerHTML = "";
        return;
      }
      setMessage(`Found ${data.length} result(s).`, true);
      tbody.innerHTML = data.map(d => `
        <tr>
          <td>${d.First || ''} ${d.Last || ''}</td>
          <td>${d.Specialty || ''}</td>
          <td>${d.Address || ''}</td>
          <td>${d.Phone || ''}</td>
          <td>${d.Fax || ''}</td>
          <td>${d.Email || ''}</td>
          <td>${d.Patients || ''}</td>
          <td>${d.From || ''}</td>
          <td>${d.NPI || ''}</td>
        </tr>
      `).join('');
    }

    function searchPatient() {
      const name = (document.getElementById('patientInput').value || '').trim();
      if (!name) { setMessage("Enter a patient name to search."); return; }
      setMessage("Searching…", true);
      google.script.run.withSuccessHandler(renderResults).searchByPatient(name);
    }

    function searchDoctor() {
      const last = (document.getElementById('docLast').value || '').trim();
      const first = (document.getElementById('docFirst').value || '').trim();
      if (!last && !first) { setMessage("Enter at least last name or first name."); return; }
      setMessage("Searching…", true);
      google.script.run.withSuccessHandler(renderResults).searchByDoctor(last, first);
    }

    window.onload = function() {
      document.getElementById("patientInput").addEventListener("keydown", e => {
        if (e.key === "Enter") { e.preventDefault(); searchPatient(); }
      });
      ["docLast","docFirst"].forEach(id => {
        document.getElementById(id).addEventListener("keydown", e => {
          if (e.key === "Enter") { e.preventDefault(); searchDoctor(); }
        });
      });
    };
  </script>
</body>
</html>